<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Comatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <title>myWebsite</title>

    <link rel="stylesheet" href="css/setting.css">
    <link rel="stylesheet" href="css/style.css">

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <script>
        function showForm(formId) {
            var forms = document.querySelectorAll('.custom-form');
            forms.forEach(function(form) {
                form.style.display = 'none';
            });

            var selectedForm = document.getElementById(formId);
            selectedForm.style.display = 'block';

            callAPI(formId);
        }

        function callAPI(formId,json = "") {
            var currentUrl = window.location.href;
            var apiUrl;
            var encodedJson = encodeURIComponent(json);

            //切換api
            switch(formId){
                case 'formA':{
                    apiUrl = currentUrl + '/Member?json=' + encodedJson;
                    break;
                }
                case 'formB':{
                    apiUrl = currentUrl + '/Product';
                    break;
                }
                case 'formC':{
                    apiUrl = currentUrl + '/Member';
                    break;
                }
            }

            console.log("Calling: ",apiUrl);

            //call api
            fetch(apiUrl)
                  .then(function(response) {
                    if (!response.ok) {
                      throw new Error('Network response was not ok');
                    }
                    var contentType = response.headers.get("content-type");
                    if (contentType && contentType.includes("application/json")) {
                      return response.json();
                    } else {
                      return response.text();
                    }
                  })
                  .then(function(data) {
                    setdata2form(formId,data);
                  })
                  .catch(function(error) {
                    console.error('Fetch error:', error);
                  });
        }

        //組成table
        function setdata2form(formId,data){

            const columnA = ["#","Name","PW","Status","Mail"];
            const columnB = ["#","Category","Name","Price","Num","onsale","src"];
            const columnC = ["#","Name","PW","Status","Mail"];

            const columnMapA = ["ID","USERNAME","PASSWORD","STATUS","MAIL"];
            const columnMapB = ["ID","CATEGORY","NAME","COST","NUM","ONSALE","SRC"];
            const columnMapC =[];
            var columnMap =[];
            var table;

            console.log("data: ",data);
            console.log("formId: ",formId);
            //切換table
            switch(formId){
                case 'formA':{
                    table = document.getElementById("tableA");
                    columnMap = columnMapA;
                    break;
                }
                case 'formB':{
                    table = document.getElementById("tableB");
                    columnMap = columnMapB;
                    break;
                }
                case 'formC':{
                    table = document.getElementById("tableC");
                    columnMap = columnMapC;
                    break;
                }
            }

            console.log("table: ",table);

            //清空tbody
            var tbody = table.querySelector("tbody");

            if(tbody != null){
                while (tbody.firstChild) {
                  tbody.removeChild(tbody.firstChild);
                }
            }

            //組成tbody
            for (var i=0;i<data.length;i++){
                var trRow = document.createElement("tr");
                for (var col in columnMap){

                    var tdCell = document.createElement("td");
                    var colname = columnMap[col];
                    tdCell.textContent = data[i][colname];
                    trRow.appendChild(tdCell);
                }
                tbody.appendChild(trRow);
            }
            table.appendChild(tbody);
        }

<!--         Button Hide-->
        function change_status(button) {
            var status = button.innerHTML;
            var table_id = button.id + "_table";
            var form = document.getElementById(table_id);
            if(status == 'SHOW'){
                button.innerHTML = 'HIDE';
                form.style.display = 'block';
            } else{
                button.innerHTML = 'SHOW';
                form.style.display = 'none';
            }
        }

        function processQuery_M(){
            var ID = document.getElementById("ID").value;
            var Name = document.getElementById("Name").value;
            var Password = document.getElementById("PW").value;
            var Mail = document.getElementById("Mail").value;
            var Status = document.querySelector('input[name="Status"]:checked').value;

            var param = {
                ID: ID,
                Name: Name,
                Password: Password,
                Mail: Mail,
                Status: Status
            };

            var jsonParam = JSON.stringify(param);
            var encodedJson = encodeURIComponent(jsonParam);

            callAPI("formA",jsonParam);

            return;
        }

        function processEdit_M(){
            var ID = document.getElementById("ID").value;
            console.log(ID);
            alert(ID);
            return;
        }
    </script>
</head>

<body>

<!-- Header -->
<header>
    <div class="nav container">
        <div class="left-part">
            <a href="/" class="logo">Ecommerce</a>
        </div>
        <div class="middle-part">
            <form th:action="@{logout}" method="POST">
                <input type="submit" value="Logout"/>
            </form>
        </div>
        <div class="right-part">
            <button class="btn btn-primary" onclick="showForm('formA')">Member</button>
            <button class="btn btn-primary" onclick="showForm('formB')">Product</button>
            <button class="btn btn-primary" onclick="showForm('formC')">Records</button>
        </div>
    </div>
</header>

<!-- Form A -->
<div id="formA" class="custom-form" style="display: none;">
    <!--    table-->
    <form id="member_table" class="container">
        <div class="row mb-3">
            <label for="ID" class="col-sm-2 col-form-label">ID*</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="ID">
            </div>
        </div>
        <div class="row mb-3">
            <label for="Name" class="col-sm-2 col-form-label">Name</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="Name">
            </div>
        </div>
        <div class="row mb-3">
            <label for="PW" class="col-sm-2 col-form-label">Password</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="PW">
            </div>
        </div>
        <div class="row mb-3">
            <label for="Mail" class="col-sm-2 col-form-label">Mail</label>
            <div class="col-sm-10">
                <input type="email" class="form-control" id="Mail">
            </div>
        </div>
        <fieldset class="row mb-3">
            <legend class="col-form-label col-sm-2 pt-0">Status</legend>
            <div class="col-sm-6">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="Status" id="Status_Enable" value="1" checked>
                    <label class="form-check-label" for="Status_Enable">
                        Enable
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="Status" id="Status_Disable" value="0">
                    <label class="form-check-label" for="Status_Disable">
                        Disable
                    </label>
                </div>
            </div>
            <div class="col-sm-4">
                <input type="button" class="btn btn-info" onclick="processQuery_M()" id="Query_M" value="Query"></input>
                <input type="button" class="btn btn-info" onclick="processEdit_M()" id="Edit_M" value="Edit"></input>
            </div>
        </fieldset>
    </form>
    <!--    button-->
    <div class="container">
        <button class="btn btn-info" onclick="change_status(this)" id="member">HIDE</button>
    </div>
    <!--data-->
    <form>
        <table id="tableA" class="table container">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">PW</th>
                <th scope="col">Status</th>
                <th scope="col">Mail</th>
            </tr>
            </thead>
            <tbody>
            </tbody>

        </table>
    </form>
</div>

<!-- Form B -->
<div id="formB" class="custom-form" style="display: none;">
    <form>
        <table  id="tableB" class="table container">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Category</th>
                <th scope="col">Name</th>
                <th scope="col">Price</th>
                <th scope="col">Num</th>
                <th scope="col">onsale</th>
                <th scope="col">src</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </form>
</div>

<!-- Form C -->
<div id="formC" class="custom-form" style="display: none;">
    <form>
        formC
        <!-- Your form C content here -->
    </form>
</div>

</body>
</html>
